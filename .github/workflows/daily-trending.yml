name: GitHub Trending Daily

on:
  schedule:
    - cron: '0 0 * * 1,3,5' # å‘¨ä¸€ã€ä¸‰ã€äº” 00:00 UTC æ‰§è¡Œ (åŒ—äº¬æ—¶é—´ 08:00)
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  send-trending:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Bun
        uses: oven-sh/setup-bun@v1

      - name: Install dependencies
        run: bun install

      - name: Run trending script
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          # ğŸ“Œ è‡ªå®šä¹‰æ¨¡å‹é…ç½®ï¼ˆå¯é€‰ï¼‰
          # å¦‚æœä½¿ç”¨é Anthropic å®˜æ–¹æ¨¡å‹ï¼Œå¯ä»¥é…ç½®ä»¥ä¸‹å˜é‡ï¼š
          ANTHROPIC_BASE_URL: ${{ secrets.ANTHROPIC_BASE_URL }}
          ANTHROPIC_MODEL: ${{ secrets.ANTHROPIC_MODEL }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
          RESEND_FROM_EMAIL: ${{ secrets.RESEND_FROM_EMAIL }}
          RESEND_TO_EMAIL: ${{ secrets.RESEND_TO_EMAIL }}
          TRENDING_LANGUAGES: ${{ secrets.TRENDING_LANGUAGES }}
          EMAIL_SEND_ENABLED: true
          NODE_ENV: production
          LOG_LEVEL: info
          LOG_LLM_OUTPUT: false
          LOG_LLM_STREAM: false
        run: bun run src/index.ts

      - name: Display execution log
        if: always()
        run: |
          echo "ä»»åŠ¡æ‰§è¡Œå®Œæˆ"
          echo "æ£€æŸ¥æ—¥å¿—ä»¥è·å–è¯¦ç»†ä¿¡æ¯"
